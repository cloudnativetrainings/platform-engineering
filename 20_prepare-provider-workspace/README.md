# Prepare Provider Workspace

In this lab you prepare the workspace for the provider.

## Grant permissions to the Provider ServiceAccount

The syncagent, running in the kubernetes cluster of the provider needs permissions in the kcp workspace.

```bash
# connect to kcp via root access
kubectx root@kcp

# switch to the workspace of the provider
kubectl ws :root:provider

# give the provider admin rights in his workspace
# TODO security concerns?
kubectl create clusterrolebinding provider:admin \
  --clusterrole=cluster-admin \
  --serviceaccount=default:provider

# verify
kubectl auth can-i get logicalclusters/cluster --as=system:serviceaccount:default:provider
kubectl auth can-i get apiexport  --as=system:serviceaccount:default:provider
kubectl auth can-i create apiexport  --as=system:serviceaccount:default:provider
```

## Create the APIExport and APIBinding

```bash
# connect to kcp via root access
kubectx provider@kcp

# verify your permissions
kubectl auth can-i get logicalclusters/cluster
kubectl auth can-i get apiexport
kubectl auth can-i create apiexport

# create the apiexport
# TODO yaml looks weired
kubectl apply -f /training/20_prepare-provider-workspace/myapiexport.yaml

# verify
kubectl get apiexport myapiexport

# bind the apiexport to the provider workspace
kubectl kcp bind apiexport root:provider:myapiexport

# get the apiresourceschema
# note this does not exist yet, it will be generated by the syncagent running in the provider cluster from the already existing CRD
kubectl get apiresourceschema
```
